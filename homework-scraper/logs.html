<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Logs - Homework Scraper</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        h1 { margin-bottom: 20px; color: #60a5fa; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 10px 20px; background: #1e293b; border: none; color: #94a3b8; cursor: pointer; border-radius: 6px; font-size: 14px; }
        .tab.active { background: #3b82f6; color: white; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        select, button { padding: 10px 16px; background: #1e293b; border: 1px solid #334155; color: #e2e8f0; border-radius: 6px; font-size: 14px; cursor: pointer; }
        button:hover { background: #334155; }
        .output { background: #1e293b; padding: 20px; border-radius: 8px; min-height: 400px; max-height: 600px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .error { color: #ef4444; background: #7f1d1d; padding: 20px; border-radius: 8px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .info-card { background: #1e293b; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .info-card h3 { font-size: 14px; color: #94a3b8; margin-bottom: 8px; }
        .info-card p { font-size: 16px; color: #e2e8f0; font-weight: 500; }
        .status-active { color: #22c55e; }
        .status-inactive { color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñ•Ô∏è Server Monitoring Dashboard</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">Overview</button>
            <button class="tab" onclick="switchTab('logs')">Logs</button>
            <button class="tab" onclick="switchTab('errors')">Errors</button>
            <button class="tab" onclick="switchTab('processes')">Processes</button>
            <button class="tab" onclick="switchTab('services')">Services</button>
        </div>

        <div class="controls" id="controls" style="display: none;">
            <select id="logType">
                <option value="django">Django</option>
                <option value="celery">Celery</option>
                <option value="celery-beat">Celery Beat</option>
                <option value="nginx">Nginx Access</option>
                <option value="nginx-error">Nginx Error</option>
            </select>
            <select id="lines">
                <option value="50">50 lines</option>
                <option value="100" selected>100 lines</option>
                <option value="200">200 lines</option>
                <option value="500">500 lines</option>
            </select>
            <button onclick="loadData()">Refresh</button>
            <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()">
                <span>Auto-refresh (5s)</span>
            </label>
        </div>

        <div id="output" class="output">
            <div class="loading">Loading...</div>
        </div>
    </div>

    <script>
        let currentTab = 'overview';
        let autoRefreshInterval = null;

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('controls').style.display = 
                (tab === 'logs' || tab === 'errors') ? 'flex' : 'none';
            
            loadData();
        }

        function toggleAutoRefresh() {
            const enabled = document.getElementById('autoRefresh').checked;
            if (enabled) {
                autoRefreshInterval = setInterval(loadData, 5000);
            } else {
                clearInterval(autoRefreshInterval);
            }
        }

        async function loadData() {
            const output = document.getElementById('output');
            output.innerHTML = '<div class="loading">Loading...</div>';

            try {
                let url = `/api/monitoring/`;

                switch(currentTab) {
                    case 'overview':
                        url = '/api/monitoring/system-status/';
                        break;
                    case 'logs':
                        const logType = document.getElementById('logType').value;
                        const lines = document.getElementById('lines').value;
                        url = `/api/monitoring/logs/?type=${logType}&lines=${lines}`;
                        break;
                    case 'errors':
                        const errorLines = document.getElementById('lines').value;
                        url = `/api/monitoring/errors/?lines=${errorLines}`;
                        break;
                    case 'processes':
                        url = '/api/monitoring/processes/';
                        break;
                    case 'services':
                        url = '/api/monitoring/services/';
                        break;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || data.detail || 'Request failed');
                }

                displayData(data);
            } catch (error) {
                output.innerHTML = `<div class="error">Error: ${error.message}<br><br>Make sure you are logged in and have permission to access monitoring data.</div>`;
            }
        }

        function displayData(data) {
            const output = document.getElementById('output');
            
            if (currentTab === 'overview' && data.system_info) {
                const info = data.system_info;
                output.innerHTML = `
                    <div class="info-grid">
                        <div class="info-card">
                            <h3>Hostname</h3>
                            <p>${info.hostname || 'N/A'}</p>
                        </div>
                        <div class="info-card">
                            <h3>System</h3>
                            <p>${info.system || 'N/A'} ${info.machine || ''}</p>
                        </div>
                        <div class="info-card">
                            <h3>Uptime</h3>
                            <p>${info.uptime || 'N/A'}</p>
                        </div>
                        <div class="info-card">
                            <h3>CPU Usage</h3>
                            <p>${info.cpu || 'N/A'}</p>
                        </div>
                    </div>
                    <div class="output" style="margin-top: 20px;">
                        <strong>Memory:</strong> ${info.memory || 'N/A'}<br>
                        <strong>Disk:</strong> ${info.disk || 'N/A'}<br>
                        <strong>Release:</strong> ${info.release || 'N/A'}<br>
                        <strong>Last Updated:</strong> ${new Date(info.timestamp).toLocaleString()}
                    </div>
                `;
            } else if (currentTab === 'services' && data.services) {
                let html = '<div style="font-family: monospace;">';
                data.services.forEach(svc => {
                    const statusClass = svc.status === 'active' ? 'status-active' : 'status-inactive';
                    html += `<div style="margin-bottom: 20px; padding: 15px; background: #0f172a; border-radius: 6px;">`;
                    html += `<strong>${svc.name}</strong>: <span class="${statusClass}">${svc.status}</span><br>`;
                    if (svc.details) {
                        html += `<pre style="margin-top: 10px; font-size: 12px; color: #94a3b8;">${svc.details}</pre>`;
                    }
                    html += `</div>`;
                });
                html += '</div>';
                output.innerHTML = html;
            } else if (currentTab === 'logs' && data.logs) {
                output.innerHTML = `<div style="color: #94a3b8;">Log Type: ${data.log_type} | Lines: ${data.lines_requested}</div><br>${escapeHtml(data.logs)}`;
            } else if (currentTab === 'errors' && data.errors) {
                output.innerHTML = escapeHtml(data.errors);
            } else if (currentTab === 'processes' && data.processes) {
                output.innerHTML = escapeHtml(data.processes);
            } else {
                output.innerHTML = JSON.stringify(data, null, 2);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        loadData();
    </script>
</body>
</html>
